{% extends 'base.html' %}
{% block title %}–û–±—ä–µ–∫—Ç—ã{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>–°–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤</h2>
        <a href="{{ url_for('add_facility') }}" class="btn btn-success">‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç</a>
    </div>

    <!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã -->
    <div class="row mb-4 g-2">
        <div class="col-md-4">
            <input type="text" class="form-control" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, —Ç–∏–ø—É –∏–ª–∏ —Ä–∞–π–æ–Ω—É...">
        </div>
        <div class="col-md-3">
            <select class="form-select" id="typeFilter">
                <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                <option value="–ö–æ—Ç–µ–ª—å–Ω–∞—è">–ö–æ—Ç–µ–ª—å–Ω–∞—è</option>
                <option value="–ù–∞—Å–æ—Å–Ω–∞—è">–ù–∞—Å–æ—Å–Ω–∞—è</option>
                <option value="–¶–¢–ü">–¶–¢–ü</option>
                <option value="–ò–¢–ü">–ò–¢–ü</option>
            </select>
        </div>
        <div class="col-md-3">
            <select class="form-select" id="districtFilter">
                <option value="">–í—Å–µ —Ä–∞–π–æ–Ω—ã</option>
                <option value="–°–µ–≤–µ—Ä–Ω—ã–π">–°–µ–≤–µ—Ä–Ω—ã–π</option>
                <option value="–õ–µ–Ω–∏–Ω—Å–∫–∏–π">–õ–µ–Ω–∏–Ω—Å–∫–∏–π</option>
                <option value="–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π">–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π</option>
                <option value="–Æ–≥–æ-–∑–∞–ø–∞–¥–Ω—ã–π">–Æ–≥–æ-–∑–∞–ø–∞–¥–Ω—ã–π</option>
            </select>
        </div>
    </div>

    {% if facilities %}
    <div class="row row-cols-1 row-cols-md-2 g-4" id="facilityCards">
        {% for facility in facilities %}
        <div class="col facility-card"
             data-name="{{ facility.name|lower }}"
             data-type="{{ facility.type|lower }}"
             data-district="{{ facility.district|lower }}">
            <div class="card shadow-sm h-100">
                <div class="card-body">
                    <h5 class="card-title">{{ facility.name }}</h5>
                    <p class="card-text mb-1"><strong>–¢–∏–ø:</strong> {{ facility.type }}</p>
                    <p class="card-text mb-1"><strong>–†–∞–π–æ–Ω:</strong> {{ facility.district }}</p>
                    {% if facility.description %}
                        <p class="card-text text-muted">{{ facility.description }}</p>
                    {% endif %}
                </div>
                <div class="card-footer bg-transparent border-0 d-flex justify-content-between">
                    <div class="card-footer bg-transparent border-0 d-flex gap-2">
                        <a href="{{ url_for('facility_detail', facility_id=facility.id) }}" class="btn btn-primary btn-sm">üîç –ü—Ä–æ—Å–º–æ—Ç—Ä</a>
                        <a href="{{ url_for('edit_facility', facility_id=facility.id) }}" class="btn btn-warning btn-sm">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                        <form method="POST" action="{{ url_for('delete_facility', facility_id=facility.id) }}" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –æ–±—ä–µ–∫—Ç {{ facility.name }}?');" style="margin:0;">
                            <button type="submit" class="btn btn-danger btn-sm">üóë –£–¥–∞–ª–∏—Ç—å</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-info mt-3">–ü–æ–∫–∞ –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞.</div>
    {% endif %}
</div>

<script>
function filterFacilities() {
    const searchValue = document.getElementById("searchInput").value.toLowerCase();
    const typeFilter = document.getElementById("typeFilter").value.toLowerCase();
    const districtFilter = document.getElementById("districtFilter").value.toLowerCase();

    document.querySelectorAll(".facility-card").forEach(card => {
        const name = card.dataset.name;
        const type = card.dataset.type;
        const district = card.dataset.district;

        const matchesSearch = name.includes(searchValue) || type.includes(searchValue) || district.includes(searchValue);
        const matchesType = !typeFilter || type === typeFilter;
        const matchesDistrict = !districtFilter || district === districtFilter;

        card.style.display = (matchesSearch && matchesType && matchesDistrict) ? "" : "none";
    });
}

document.getElementById("searchInput").addEventListener("input", filterFacilities);
document.getElementById("typeFilter").addEventListener("change", filterFacilities);
document.getElementById("districtFilter").addEventListener("change", filterFacilities);
</script>
{% endblock %}
